### face-api.js

TensorFlow.js 기반의 JavaScript 얼굴 인식 라이브러리

- **TinyFaceDetector**: 가벼운 얼굴 검출 모델 (빠른 처리 속도)
- **FaceLandmark68Net**: 얼굴의 68개 랜드마크 포인트 검출
- **FaceRecognitionNet**: 얼굴의 특징을 128차원 벡터로 변환
- **FaceExpressionNet**: 얼굴 표정 인식 (7가지 감정 분류)
- **AgeGenderNet**: 나이 및 성별 추정

### Face Descriptor (얼굴 임베딩)

얼굴의 특징을 수치화한 128차원 벡터로, 각 얼굴마다 고유한 값 보유. 이 벡터를 비교하여 두 얼굴이 같은 사람인지 판단.

### 유클리드 거리 기반 유사도 계산

두 얼굴의 유사도는 descriptor 간의 **유클리드 거리(Euclidean Distance)**로 측정:

- 거리가 **0에 가까울수록**: 두 얼굴이 매우 유사 (같은 사람일 가능성 높음)
- 거리가 **멀수록**: 두 얼굴이 다름

### Threshold 기반 필터링

이 프로젝트는 기본적으로 **0.6**의 threshold를 사용:

- 거리가 0.6 **이하**인 경우: 같은 사람으로 판단
- 거리가 0.6 **초과**인 경우: 다른 사람으로 판단

threshold가 낮을수록 판단 기준이 엄격해집니다.

## 추가 기능

### 표정 인식 (Expression Detection)

FaceExpressionNet 모델을 사용하여 얼굴 표정을 7가지 감정으로 분류:

- **happy**: 행복
- **sad**: 슬픔
- **angry**: 화남
- **surprised**: 놀람
- **disgusted**: 혐오
- **fearful**: 두려움
- **neutral**: 무표정

각 감정에 대한 확률값(0-1)을 제공하며, 가장 높은 확률의 감정을 주요 표정으로 표시

### 나이 및 성별 추정 (Age & Gender Recognition)

AgeGenderNet 모델을 사용하여 검출된 얼굴의 나이와 성별을 추정:

- **나이**: 예상 나이를 숫자로 추정 (예: 25세)
- **성별**: 남성 또는 여성으로 분류
- **확률**: 성별 추정에 대한 신뢰도 제공 (0-1)

나이와 성별 추정은 대략적인 값이며, 실제와 차이 존재 가능성 있음.

### 얼굴 자동 크롭 (Face Cropping)

검출된 얼굴 영역만 자동으로 추출하여 다운로드:

- **자동 여백**: 얼굴 박스 크기의 20% 여백 추가
- **경계 처리**: 이미지 경계를 넘지 않도록 자동 조정
- **다운로드**: JPEG 형식(품질 95%)으로 저장
- **다중 얼굴**: 한 사진에 여러 얼굴이 있을 경우 모두 개별 다운로드

결과 갤러리에서 각 사진에 마우스를 올리면 다운로드 버튼이 표시.

### 실시간 얼굴 추적 (Real-time Face Tracking)

웹캠을 통한 실시간 얼굴 인식 및 분석:

- **실시간 검출**: 약 10fps로 얼굴을 실시간 검출
- **시각화**: Canvas 오버레이로 bounding box와 랜드마크 표시
- **정보 표시**: 표정, 나이, 성별을 실시간으로 분석하여 표시
- **얼굴 캡처**: 현재 프레임을 캡처하여 기준 얼굴 사진으로 등록 가능
- **성능 최적화**: 프레임 스킵으로 브라우저 성능 최적화

웹캠 접근 권한이 필요하며, HTTPS 환경에서만 작동.

## 처리 흐름

### 얼굴 매칭 모드

1. **모델 로드**: 페이지 로드 시 face-api.js의 5가지 모델을 로드
2. **얼굴 검출**: 업로드된 이미지들에서 얼굴을 검출
3. **특징 추출**: 각 얼굴의 descriptor, 표정, 나이, 성별을 추출
4. **거리 계산**: 기준 얼굴과 각 얼굴 간의 유클리드 거리 계산
5. **필터링**: threshold(0.6) 이하인 사진만 선택
6. **정렬 및 표시**: 유사도 순으로 정렬하여 결과 표시 (표정, 나이, 성별 포함)
7. **얼굴 크롭**: 원하는 사진의 얼굴만 추출하여 다운로드 가능

### 실시간 추적 모드

1. **웹캠 시작**: 사용자 권한 요청 후 웹캠 스트림 시작
2. **프레임 분석**: 약 10fps로 각 프레임에서 얼굴 검출
3. **실시간 표시**: bounding box, 랜드마크, 표정, 나이, 성별을 실시간 표시
4. **얼굴 등록**: 원하는 순간에 현재 프레임을 캡처하여 기준 사진으로 등록
