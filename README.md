# 마라톤 얼굴 찾기 PoC

여러 장의 마라톤 대회 사진 중에서 내 얼굴이 포함된 사진을 자동으로 찾아주는 웹 애플리케이션입니다.

## 프로젝트 개요

이 프로젝트는 **완전 클라이언트 사이드**에서 동작하는 얼굴 인식 시스템입니다. 모든 이미지 처리와 얼굴 인식이 브라우저 내에서 이루어지므로, 이미지가 서버로 전송되지 않아 개인정보 보호에 안전합니다.

### 주요 기능

1. **대회 사진 업로드**: 마라톤 대회 등에서 촬영된 사진을 최대 50장까지 업로드
2. **기준 얼굴 등록**: 본인의 얼굴이 잘 나온 사진 1장을 기준으로 등록
3. **얼굴 인식 및 비교**: face-api.js를 사용하여 각 사진에서 얼굴을 검출하고 비교
4. **결과 표시**: 본인과 유사한 얼굴이 포함된 사진을 유사도와 함께 표시

## 기술 스택

- **프레임워크**: Next.js 16 (App Router)
- **언어**: TypeScript
- **스타일링**: Tailwind CSS
- **얼굴 인식**: face-api.js
- **패키지 관리**: npm

## 핵심 기술 및 개념

### face-api.js

face-api.js는 TensorFlow.js 기반의 JavaScript 얼굴 인식 라이브러리입니다. 이 프로젝트에서는 다음 모델들을 사용합니다:

- **TinyFaceDetector**: 가벼운 얼굴 검출 모델 (빠른 처리 속도)
- **FaceLandmark68Net**: 얼굴의 68개 랜드마크 포인트 검출
- **FaceRecognitionNet**: 얼굴의 특징을 128차원 벡터로 변환

### Face Descriptor (얼굴 임베딩)

얼굴 인식의 핵심은 **Face Descriptor**입니다. 이는 얼굴의 특징을 수치화한 128차원 벡터로, 각 얼굴마다 고유한 값을 가집니다. 이 벡터를 비교하여 두 얼굴이 같은 사람인지 판단합니다.

### 유클리드 거리 기반 유사도 계산

두 얼굴의 유사도는 descriptor 간의 **유클리드 거리(Euclidean Distance)**로 측정합니다:

- 거리가 **0에 가까울수록**: 두 얼굴이 매우 유사 (같은 사람일 가능성 높음)
- 거리가 **멀수록**: 두 얼굴이 다름

### Threshold 기반 필터링

이 프로젝트는 기본적으로 **0.6**의 threshold를 사용합니다:

- 거리가 0.6 **이하**인 경우: 같은 사람으로 판단
- 거리가 0.6 **초과**인 경우: 다른 사람으로 판단

threshold가 낮을수록 판단 기준이 엄격해집니다.

## 설치 및 실행

### 1. 저장소 클론 (또는 프로젝트 다운로드)

```bash
cd detectvision
```

### 2. 의존성 패키지 설치

```bash
npm install
```

### 3. 개발 서버 실행

```bash
npm run dev
```

### 4. 브라우저에서 접속

```
http://localhost:3000
```

## 사용 방법

### 1단계: 대회 사진 업로드

- "사진 선택" 버튼을 클릭하여 마라톤 대회 사진들을 업로드합니다.
- 최대 50장까지 한 번에 선택 가능합니다.
- 업로드된 사진은 썸네일로 미리 볼 수 있습니다.

### 2단계: 기준 얼굴 사진 업로드

- "내 얼굴 사진 선택" 버튼을 클릭하여 본인의 얼굴이 잘 나온 사진 1장을 업로드합니다.
- 정면을 향한 얼굴이 명확하게 나온 사진을 사용하면 더 정확한 결과를 얻을 수 있습니다.

### 3단계: 분석 실행

- "내 얼굴이 나온 사진 찾기" 버튼을 클릭합니다.
- 분석 진행 상황이 프로그레스 바로 표시됩니다.
- 분석이 완료되면 결과가 자동으로 표시됩니다.

### 4단계: 결과 확인

- 유사도가 높은 순서대로 사진이 정렬됩니다.
- 각 사진에는 유사도 퍼센트가 표시됩니다.
- 사진을 클릭하면 큰 크기로 볼 수 있습니다.

## 프로젝트 구조

```
detectvision/
├── app/
│   ├── page.tsx              # 메인 페이지 (상태 관리 및 로직)
│   ├── layout.tsx            # 루트 레이아웃
│   └── globals.css           # 글로벌 스타일
├── components/
│   ├── PhotoUploader.tsx     # 대회 사진 업로드 컴포넌트
│   ├── FacePreview.tsx       # 기준 얼굴 사진 미리보기
│   ├── ResultGallery.tsx     # 결과 사진 갤러리
│   └── ImageModal.tsx        # 이미지 확대 모달
├── lib/
│   ├── types.ts              # TypeScript 타입 정의
│   └── faceRecognition.ts    # face-api.js 유틸리티 함수
├── public/
│   └── models/               # face-api.js 모델 파일들
├── package.json
└── README.md
```

## 처리 흐름

1. **모델 로드**: 페이지 로드 시 face-api.js 모델들을 로드
2. **얼굴 검출**: 업로드된 이미지들에서 얼굴을 검출
3. **Descriptor 추출**: 각 얼굴의 128차원 벡터를 추출
4. **거리 계산**: 기준 얼굴과 각 얼굴 간의 유클리드 거리 계산
5. **필터링**: threshold(0.6) 이하인 사진만 선택
6. **정렬 및 표시**: 유사도 순으로 정렬하여 결과 표시

## 제한사항 및 고려사항

### 성능

- **이미지 크기**: 고해상도 이미지는 자동으로 리사이즈(긴 변 기준 800px)되어 처리 속도를 최적화합니다.
- **처리 시간**: 사진 1장당 약 1-3초 소요 (컴퓨터 성능에 따라 다름)
- **브라우저 메모리**: 많은 사진을 한 번에 처리하면 브라우저 메모리를 많이 사용할 수 있습니다.

### 정확도

- **얼굴 각도**: 정면 얼굴이 가장 정확하게 인식됩니다.
- **조명 조건**: 밝고 균일한 조명에서 촬영된 사진이 더 정확합니다.
- **가림**: 선글라스, 마스크 등으로 얼굴이 가려진 경우 인식률이 떨어집니다.
- **해상도**: 얼굴이 너무 작거나 흐릿한 경우 검출이 어려울 수 있습니다.

### 개인정보 보호

- 모든 처리가 클라이언트 사이드에서 이루어집니다.
- 이미지가 서버로 전송되지 않습니다.
- 브라우저를 닫으면 모든 데이터가 삭제됩니다.

## 개발 정보

### 빌드

프로덕션 빌드 생성:

```bash
npm run build
```

### 프로덕션 실행

```bash
npm start
```

### 린트

```bash
npm run lint
```

## 라이센스

이 프로젝트는 PoC(Proof of Concept) 목적으로 제작되었습니다.

## 참고 자료

- [face-api.js 공식 문서](https://github.com/justadudewhohacks/face-api.js)
- [Next.js 공식 문서](https://nextjs.org/docs)
- [Tailwind CSS 공식 문서](https://tailwindcss.com/docs)
